#!/bin/bash

set -euo pipefail

declare -x SSH_AUTH_SOCK=''
SSH_AUTH_SOCK="$(gpgconf -L agent-ssh-socket)"
declare BOOTSTRAP_D="${BASH_SOURCE[0]}.d"
export PATH="/opt/homebrew/bin:/usr/local/bin:/usr/sbin:/sbin:$PATH"

declare _file=""
printf 'Running yadm bootstrap\n'
for _file in "$BOOTSTRAP_D"/*; do
    test -x "$_file" || continue
    [[ "$_file" = *##* ]] && continue
    [[ "$_file" = *~ ]] && continue
    printf 'Executing %s\n' "$_file"
    "$_file"
done
